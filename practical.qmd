---
title: "Monitoring the growth of African cities using EO"
author: José Gómez-Dans
format:
  html:
    theme: cosmo
    code-copy: true        # Adds the copy button to all code blocks
    code-link: false        # Keep false for JS as it's mainly for R/Python
    highlight-style: github # Good for clean code reading
  pdf:
    documentclass: article
---


## Introduction
This practical aims to showcase a fairly typical Earth Observation workflow: use the spaceborne acquired data to delineate or map different areas of interest. The actual application is to map the growth of cities (so to map "built-up" or "non-built-up" areas) over time. 

### Background

Where cities expand (and where they don't) affects the everyday life of their citizens: water, sanitation, access to education, jobs, exposure to adverse meteorological conditions, ... In West Africa, most of this urban growth happens on the fringes, and is largely informal. This means that there is little information to e.g., provide required services once an area has been settled. 

Climate shocks can nudge these patterns. In many parts of West Africa, drought years hit rain-fed agriculture hard. When rural incomes fall, some people move, sometimes temporarily, sometimes permanently, toward larger cities with potentially better labour/livelihood opportunities. That movement can leave a spatial fingerprint: new, fast-growing neighbourhoods at the edge of the city, often on cheap or marginal land.  In recent years, civil strife has also produced a large number of displaced people, compounding the drivers of the influx. Limited resources in this region often mean that information is woefully inadequate for policy makers to act on. Fast and informal growth can also increase risk of flooding (as settlements occur in floodplains, wetlands, or block drainage corridors). Dwellers can also become urban heat hotspots, in addition to issues carried out by lack of sanitation and clean drinking water.

In the practical you will: (1) build annual Landsat composites, (2) classify land cover into urban, forest, vegetated, bare soil, and water using a Random Forest model, (3) create an urban-area time series, and (4) infer what's going on. By the end, you’ll have a reproducible workflow and a set of figures that tell a clear story about how a West African city has changed. While you'll be focussing on a particular city, the potential is there for running this analyses over larger and larger areas, and using this evidence to test for, e.g., quantising the "why" and the "how" of these migrations.

### Brief description of the activity

In this activity, we'll use data from the [Landsat archive](https://landsat.usgs.gov/landsat-archive-dashboard). The Landsat family of sensors is the longest continuous data record of EO data (since the early 1970s until now). The Landsat archive provides an incredible record of the changes and evolution of the land surface for the last half century. Using this data is not without challenges though: in order to cover such a large time span, different satellites carrying slightly different versions of the imaging sensor have been used, introducing discrepancies.

Landsat is an optical sensor, and as such, cannot collect data at night, under clouds or under cloud shadows. In areas with persistent cloud cover, the 16-day revisit period for Landsat can result in a depressing meagre number of actual observations! Additionally, for surface applications, the effect of the atmosphere needs to be taking into account. A lot of effort has gone in homogenising and making the actual data as easy and useful to end users, via a process of "[calibration and validation](https://science.nasa.gov/mission/landsat/calibration-validation/)", and producing derived products that employ sophisticated algorithms to map clouds, correct for sensor differences, etc. While these advanced products are invaluable, it is hard to come up with a degree of quality that satisfies all users, so a degree of additional *preprocessing* is often a crucial step.

In terms of urban growth, you will be looking at a time series data (e.g., from 2000 up to 2025, considering every fifth year), and looking to build a *classifier* that maps the data recorded by the sensor on each pixel to a fixed set of labels (e.g., "urban", "water", "vegetation", etc.). The *classifier* needs to be defined, and this is done by gathering a so-called *training-validation-testing* dataset: you will need to select a large set of pixels and label them using the required class labels. Part of this dataset is used to then "train" the classifier, and part of it should be used to assess the quality of the classification and its uncertainty. Once the classifier is trained and validated, you can produce maps of different classes, and use them to quantify the urban growth.

## Data and methods

### Google Earth Engine (GEE)

Even though the Landsat archive is free of charge and there are many ways of accessing it and using the data, here we will use [Google Earth Engine](https://earthengine.google.com/).

::: {.callout-important}
#### Getting a GEE account

You will need a Google (or a "gmail") account and then you can signup for GEE  [here](https://earthengine.google.com/signup/). Follow the instructions therein 

**Note that this process can take a few days to complete!!**
:::

GEE is a cloud based solution, in which most of the heavy processing is done in Google's servers. The processing is defined using a high level computing language (we'll use javascript via the browser here, but Python is another possibility). Generally speaking, we will do most of the processing on GEE via the browser, but will export results (as e.g., raster files) that can then be further explored in other software tools. @fig-gee-code-editor shows a labelled screenshot of GEE's main editor window.

![The GEE code editor (from [here](https://open-mrv.readthedocs.io/))](GEEcodeEditor.png){#fig-gee-code-editor}


## Annual composite creation

### Satellite data
We use Landsat surface reflectance data provided through Google Earth Engine. Landsat offers a unique, continuous global record of Earth observations from the 1980s to the present, making it particularly suitable for long-term urban studies.
To ensure consistency across time, we combine data from multiple Landsat sensors:

* Landsat 5 TM (for earlier years)
* Landsat 7 ETM+
* Landsat 8 OLI
* Landsat 9 OLI-2


All datasets are taken from the [Collection 2, Tier 1, Level-2 Surface Reflectance products](https://www.usgs.gov/landsat-missions/landsat-collection-2-surface-reflectance). These data have already been radiometrically calibrated and atmospherically corrected, allowing surface reflectance values to be compared across sensors and years.

### Temporal selection

The analysis will be performed for the following years:
2000, 2005, 2010, 2015, 2020, and 2024
These snapshots provide a simple but effective way to visualise long-term urban expansion.

::: {.callout-important}

@fig-bamako is the typical cloudiness in Bamako (from [here](https://www.meteoblue.com/en/weather/historyclimate/climatemodelled/bamako_mali_2460596))

![Bamako cloudiness/precipitation meteogram](bamako.png){#fig-bamako}

Does that suggest anything useful in terms of creating an annual mosaic? Can yuou think of any period(s) that might be most useful and why?

:::


### Cloud masking and quality control
Satellite images are affected by clouds, cloud shadows, and other artefacts that can obscure the surface. To address this, we apply a quality mask based on the Landsat `QA_PIXEL` band.
Pixels flagged as any of the following are removed:


* Fill (missing data)
* Dilated cloud
* Cirrus cloud
* Cloud
* Cloud shadow

In addition, scenes are filtered using metadata to retain only images with less than 70% reported cloud cover. To keep processing efficient, no more than 25 images per year are used, prioritising the clearest scenes.

### Band harmonisation and scaling
Different Landsat sensors store spectral bands using different band numbers. To allow images from different missions to be combined:

Spectral bands are renamed to a common set of names (`blue`, `green`, `red`, `nir`, `swir1`, `swir2`). @tbl-bands shows what these bands represent.

| Band name | Spectral region      | Approx. wavelength (nm) | What it is commonly used for |
|---------|----------------------|--------------------------|------------------------------|
| blue    | Blue                 | 450–510                  | Water, haze, urban features |
| green  | Green                | 520–600                  | Vegetation reflectance, urban areas |
| red    | Red                  | 630–690                  | Vegetation vs built-up contrast |
| nir    | Near-infrared (NIR)  | 760–900                  | Vegetation health, biomass |
| swir1  | Shortwave IR (SWIR)  | 1550–1750                | Built-up areas, soil, moisture |
| swir2  | Shortwave IR (SWIR)  | 2080–2350                | Urban materials, dryness, fire scars |
: Common Landsat spectral bands {#tbl-bands}


::: {.callout-tip}

This harmonisation step ensures that reflectance values are directly comparable across sensors and years.

:::

Surface reflectance values are rescaled using the official Landsat Collection 2 scaling factors



### Additional spectral *features* ("indices")

![Sample spectral reflectance of vegetation, crops, built-up, bare soils and water classes (from [DOI:10.1016/j.isprsjprs.2017.11.006](https://doi.org/10.1016/j.isprsjprs.2017.11.006)](The-spectral-reflectance-curves-of-vegetation-cropland-building-soil-water_W640.jpg){#fig-reflectance}


Some simple manipulations of reflectance are useful to differentiate different land cover classes. For example, the large  reflectance contrast between the `nir` and `red` bands in healthy vegetation (see @fig-reflectance) can be used to detect its prevalence. Similar empirical relationships have been investigated for other scene types, such as urban areas or water. In @tbl-indices there's brief summary of these

| Index | Full name | Formula (Landsat bands) | What it highlights | Notes |
|------|-----------|--------------------------|--------------------|-------|
| NDBI | Normalised Difference Built-up Index | (swir1 − nir) / (swir1 + nir) | Built-up / impervious surfaces | Simple, widely used; can confuse bare soil |
| UI | Urban Index | (swir2 − nir) / (swir2 + nir) | Dense urban areas | Strong urban contrast; more noise-sensitive |
| IBI | Index-based Built-up Index | (NDBI − (NDVI + MNDWI)) / (NDBI + (NDVI + MNDWI)) | Built-up areas with vegetation and water suppressed | More complex but very effective |
| EBBI | Enhanced Built-up and Bareness Index | (swir1 − nir) / (10 × √(swir1 + TIR)) | Built-up vs bare soil | Requires thermal band; advanced |
| NDVI | Normalised Difference Vegetation Index | (nir − red) / (nir + red) | Vegetation | Often used as a vegetation mask, not an urban index |
| MNDWI | Modified Normalised Difference Water Index | (green − swir1) / (green + swir1) | Water bodies | Used within IBI to suppress water |

: Useful empirical band combinations (*indices*) {#tbl-indices}



### Annual image composites
For each year, all selected and processed images are combined into a single annual composite using the median value of each pixel.
Using the median:


* Reduces the influence of residual clouds or outliers
* Produces a more stable and representative image of surface conditions
* Is well suited for urban studies where abrupt extremes are not desired


Each annual composite is clipped to the AOI and assigned a timestamp corresponding to the study year.

### Visualisation
For exploratory analysis, annual composites are displayed as true-colour (RGB) images using the red, green, and blue bands. A consistent reflectance stretch is applied across all years to ensure that visual differences primarily reflect real land surface change rather than display settings.

### Summary
In this first stage of the practical, we:
1 .Define an urban area of interest
2. Select multi-decadal Landsat surface reflectance data
3. Apply cloud masking and quality filtering
4. Harmonise spectral bands across sensors
5. Create annual composites with different feature sets

These annual mosaics form the foundation for later steps in the practical, where we will quantify and interpret urban growth patterns.

## Supervised classification and class definition

To map urban expansion, we use a *supervised classification* approach. In supervised classification, the algorithm "learns" how different land cover types appear in satellite data based on *training samples* provided by the user. In this practical, you can define three or four land cover classes (e.g., built-up areas, vegetation, bare soil, and water. Although all classes are included to improve discrimination, the primary focus of the analysis is on identifying **built-up (urban) areas** accurately.

::: {.callout-tip}
Having additional classes can be useful if there are some uninteresting" classes are very distinct (e.g. water or vegetation) that can confuse the algorithm.
:::

Training data are provided as a **labelled feature collection**, where each feature represents a location with a known land cover class. These training labels are typically created by manually digitising polygons or points using high-resolution imagery as reference. Each training feature contains a class identifier (e.g. an integer code) that links the sample to one of the four land cover types. Spectral values and indices (e.g. NDBI, NDVI) are extracted from the Landsat composites at these locations and used as input to the classifier.

We use a **Random Forest (RF)** classifier, which is an ensemble machine-learning method based on many decision trees. RF is well suited to remote sensing applications because it handles non-linear relationships, is relatively robust to noise, and performs well with a limited number of training samples. The labelled data are split into training and testing subsets, typically using a random partition (for example, 70% for training and 30% for testing). The training subset is used to build the model, while the testing subset provides an independent estimate of classification accuracy.

Model performance can be roughly *validated* using a confusion matrix and overall accuracy derived from the testing data. Additional qualitative validation is encouraged by visually comparing the classified map with true-colour imagery and checking whether built-up areas correspond to known urban features such as dense neighbourhoods and road networks. This combination of quantitative and visual checks will helpyou assess the suitability of your results and whether they are fit for purpose.





